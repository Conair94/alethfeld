\documentclass[11pt]{article}

% Packages
\usepackage{amsmath,amssymb,amsthm}
\usepackage[margin=1in]{geometry}
\usepackage{enumitem}

% Theorem environments
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}

% Lamport-style numbering for proof steps
\newlist{proofstep}{enumerate}{2}
\setlist[proofstep,1]{label=$\langle 1 \rangle$\arabic*.,ref=$\langle 1 \rangle$\arabic*,leftmargin=2em}
\setlist[proofstep,2]{label=$\langle 2 \rangle$\arabic*.,ref=$\langle 2 \rangle$\arabic*,leftmargin=2em}

\begin{document}

\begin{theorem}[Matrix Determinant Lemma]\label{thm:mdl}
Let $M$ be an invertible $n \times n$ matrix and let $u, v \in \mathbb{R}^n$ be column vectors. Then
\[
\det(M + uv^\top) = (1 + v^\top M^{-1} u) \det(M).
\]
\end{theorem}

\begin{proposition}\label{prop:determinant}
For $a_1, a_2, \ldots, a_n \neq 0$,
\[
d_n = \begin{vmatrix}
1+a_1 & 1 & \cdots & 1 \\
1 & 1+a_2 & \cdots & 1 \\
\vdots & \vdots & \ddots & \vdots \\
1 & 1 & \cdots & 1+a_n
\end{vmatrix}
= \left(1 + \sum_{k=1}^{n} \frac{1}{a_k}\right) a_1 a_2 \cdots a_n.
\]
\end{proposition}

\begin{proof}
Let $D = \operatorname{diag}(a_1, \ldots, a_n)$ denote the diagonal matrix with entries $a_1, \ldots, a_n$, and let $\mathbf{1} = (1, 1, \ldots, 1)^\top$ denote the ones vector. We write $A = D + \mathbf{1}\mathbf{1}^\top$ for the matrix decomposition.

\begin{proofstep}
\item $A = D + \mathbf{1}\mathbf{1}^\top$ decomposition.
  \begin{proofstep}
  \item Verify $A_{ij} = (D + \mathbf{1}\mathbf{1}^\top)_{ij} = a_i \cdot \delta_{ij} + 1$.

    (The diagonal entries are $a_i + 1$ and all off-diagonal entries are $1$, matching the given matrix.)
  \end{proofstep}

\item $D$ is invertible with $D^{-1} = \operatorname{diag}(1/a_1, \ldots, 1/a_n)$.

  (Since each $a_k \neq 0$, the diagonal matrix $D$ is invertible.)

\item $\det(D) = a_1 \cdot a_2 \cdots a_n$.

  (By the determinant property of diagonal matrices.)

\item By the Matrix Determinant Lemma (Theorem~\ref{thm:mdl}):
\[
\det(D + \mathbf{1}\mathbf{1}^\top) = (1 + \mathbf{1}^\top D^{-1} \mathbf{1}) \det(D).
\]

  (Apply Theorem~\ref{thm:mdl} with $M = D$ and $u = v = \mathbf{1}$.)

\item $\mathbf{1}^\top D^{-1} \mathbf{1} = \sum_{k=1}^{n} \frac{1}{a_k}$.
  \begin{proofstep}
  \item $D^{-1} = \operatorname{diag}(1/a_1, \ldots, 1/a_n)$.

    (From step $\langle 1 \rangle$2.)
  \item $D^{-1} \cdot \mathbf{1} = (1/a_1, \ldots, 1/a_n)^\top$.

    (Diagonal matrix applied to the ones vector.)
  \item Dot product: $\mathbf{1}^\top \cdot (1/a_1, \ldots, 1/a_n)^\top = \sum_{k=1}^{n} \frac{1}{a_k}$.

    (Standard inner product computation.)
  \end{proofstep}

\item Substitute into the formula:
\[
d_n = \det(A) = \det(D + \mathbf{1}\mathbf{1}^\top) = \left(1 + \sum_{k=1}^{n} \frac{1}{a_k}\right) \cdot a_1 a_2 \cdots a_n.
\]

  (Combining steps $\langle 1 \rangle$3, $\langle 1 \rangle$4, and $\langle 1 \rangle$5.) \qedhere
\end{proofstep}
\end{proof}

\end{document}
